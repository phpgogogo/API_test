<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <!-- datatable -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.css">




</head>

<body>
    <div class="container">
        <div>
            <button id="all">全部</button>
            <button id="north">北部</button>
            <button id="mid">中部</button>
            <button id="south">南部</button>
            <button id="east">東部</button>
            <button id="test">test</button>
        </div>
        <h1 class="text-center">各縣市累積降雨量</h1>
        <table id="table_id" class="table table-hover table-striped text-center">
            <thead>
                <tr>
                    <th>id</th>
                    <th>縣市</th>
                    <th>時間1</th>
                    <th>時間2</th>
                    <th>時間3</th>
                    <th>時間4</th>
                    <th>時間5</th>
                    <th>時間6</th>

                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>

        <!-- Button trigger modal -->
        <button id="60min_total" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            各地區60分鐘總降雨量
        </button>
        <button id="24hr_total" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            各地區24小時總降雨量
        </button>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">各地區60分鐘總雨量</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <canvas id="myChart"></canvas>
                        <canvas id="myChart2"></canvas>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>


    </div>



    <!-- 先載入 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
        integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2"
        crossorigin="anonymous"></script>
    <!-- datatable -->
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.js"></script>
    <!-- chart js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"
        integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- 先載入 END-->

    <script>
        $(document).ready(function () {
            $.ajax({ //Process the form using $.ajax()
                type: 'get', //Method type
                url: 'https://opendata.cwb.gov.tw/fileapi/v1/opendataapi/O-A0002-001?Authorization=CWB-4EBAEEC1-2629-4C09-B0C7-9A75DA7A359B&downloadType=WEB&format=JSON', //Your form processing file URL
                data: $(this).serialize(), //Forms name
                dataType: 'json',
                success: function (result) {
                    data = result.cwbopendata.location;
                    console.log("縣市:", data[0].parameter[0].parameterValue);
                    console.log("地名:", data[0].locationName);
                    console.log("高度:", data[0].weatherElement[0].elementValue.value, "公尺");
                    console.log("測量時間:", data[0].time.obsTime);
                    console.log("60分鐘累積雨量:", data[0].weatherElement[1].elementValue.value, "mm");
                    console.log("10分鐘累積雨量:", data[0].weatherElement[2].elementValue.value, "mm");
                    console.log("3小時累積雨量:", data[0].weatherElement[3].elementValue.value, "mm");
                    console.log("6小時累積雨量:", data[0].weatherElement[4].elementValue.value, "mm");
                    console.log("12小時累積雨量:", data[0].weatherElement[5].elementValue.value, "mm");
                    console.log("24小時累積雨量:", data[0].weatherElement[6].elementValue.value, "mm");
                    console.log("本日累積雨量:", data[0].weatherElement[7].elementValue.value, "mm");
                    console.log("前1日0時到現在之累積雨量:", data[0].weatherElement[8].elementValue.value, "mm");
                    console.log("前2日0時到現在之累積雨量:", data[0].weatherElement[9].elementValue.value, "mm");
                    // time0.getFullYear()
                    time0 = new Date(data[0].time.obsTime);
                    console.log(time0);
                    console.log("year", time0.getFullYear());
                    console.log("month", time0.getMonth() + 1);
                    console.log("day", time0.getDate());
                    console.log("hour", time0.getHours());
                    console.log("資料筆數:", data.length);

                    $("h1").prepend(`${time0.getFullYear()}/${time0.getMonth() + 1}/${time0.getDate()}`);
                    $("tr>th").eq(1).text(`縣市`)
                    $("tr>th").eq(2).text(`地名`)
                    $("tr>th").eq(3).text(`60分鐘累積雨量`)
                    $("tr>th").eq(4).text(`3小時累積雨量`)
                    $("tr>th").eq(5).text(`6小時累積雨量`)
                    $("tr>th").eq(6).text(`12小時累積雨量`)
                    $("tr>th").eq(7).text(`24小時累積雨量`)

                    for (i = 0; i < data.length; i++) {
                        $("tbody").append(`
                    <tr>
                        <th>${i + 1}</th>
                        <th>${data[i].parameter[0].parameterValue}</th>
                        <th>${data[i].locationName}</th>
                        <th>${data[i].weatherElement[1].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[3].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[4].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[5].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[6].elementValue.value}mm</th>
                    </tr>`);
                    }
                    $("#table_id").DataTable();

                    const north = ["新北市", "臺北市", "基隆市", "新竹市", "桃園市", "新竹縣", "宜蘭縣"];
                    const mid = ["臺中市", "苗栗縣", "彰化縣", "南投縣", "雲林縣"];
                    const south = ["高雄市", "臺南市", "嘉義市", "嘉義縣", "屏東縣", "澎湖縣"];
                    const east = ["花蓮縣", "臺東縣"];

                    $("#north").on("click", function () {
                        $("tbody").html("");
                        // $("#table_id").DataTable().destroy();
                        // $("#table_id").empty();
                        // $("#table_id").empty();
                        // $("#table_id").hide();
                        $("h1").text(`${time0.getFullYear()}/${time0.getMonth() + 1}/${time0.getDate()}北部地區累積降雨量`);
                        for (i = 0; i < data.length; i++) {
                            if (north.indexOf(data[i].parameter[0].parameterValue) >= 0) {
                                $("tbody").append(`
                    <tr>
                        <th>${i + 1}</th>
                        <th>${data[i].parameter[0].parameterValue}</th>
                        <th>${data[i].locationName}</th>
                        <th>${data[i].weatherElement[1].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[3].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[4].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[5].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[6].elementValue.value}mm</th>
                    </tr>`);
                            }
                        }
                        $("#table_id").DataTable();

                    })
                    $("#mid").on("click", function () {
                        $("tbody").html("");
                        $("h1").text(`${time0.getFullYear()}/${time0.getMonth() + 1}/${time0.getDate()}中部地區累積降雨量`);
                        for (i = 0; i < data.length; i++) {
                            if (mid.indexOf(data[i].parameter[0].parameterValue) >= 0) {
                                $("tbody").append(`
                    <tr>
                        <th>${i + 1}</th>
                        <th>${data[i].parameter[0].parameterValue}</th>
                        <th>${data[i].locationName}</th>
                        <th>${data[i].weatherElement[1].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[3].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[4].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[5].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[6].elementValue.value}mm</th>
                    </tr>`);
                            }
                        }

                    })
                    $("#south").on("click", function () {
                        $("tbody").html("");
                        $("h1").text(`${time0.getFullYear()}/${time0.getMonth() + 1}/${time0.getDate()}南部地區累積降雨量`);
                        for (i = 0; i < data.length; i++) {
                            if (south.indexOf(data[i].parameter[0].parameterValue) >= 0) {
                                $("tbody").append(`
                    <tr>
                        <th>${i + 1}</th>
                        <th>${data[i].parameter[0].parameterValue}</th>
                        <th>${data[i].locationName}</th>
                        <th>${data[i].weatherElement[1].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[3].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[4].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[5].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[6].elementValue.value}mm</th>
                    </tr>`);
                            }
                        }

                    })
                    $("#east").on("click", function () {
                        $("tbody").html("");
                        $("h1").text(`${time0.getFullYear()}/${time0.getMonth() + 1}/${time0.getDate()}東部地區累積降雨量`);
                        for (i = 0; i < data.length; i++) {
                            if (east.indexOf(data[i].parameter[0].parameterValue) >= 0) {
                                $("tbody").append(`
                    <tr>
                        <th>${i + 1}</th>
                        <th>${data[i].parameter[0].parameterValue}</th>
                        <th>${data[i].locationName}</th>
                        <th>${data[i].weatherElement[1].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[3].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[4].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[5].elementValue.value}mm</th>
                        <th>${data[i].weatherElement[6].elementValue.value}mm</th>
                    </tr>`);
                            }
                        }

                    })
                    $("#all").on("click", function () {
                        location.reload();

                    })
                    // $("#table_id").DataTable();

                    // 撈出各地區60分鐘總雨量
                    north_total = 0;
                    mid_total = 0;
                    south_total = 0;
                    east_total = 0;
                    north_length = 0;
                    mid_length = 0;
                    south_length = 0;
                    east_length = 0;
                    data.forEach((value, key) => {
                        if (north.indexOf(value.parameter[0].parameterValue) >= 0 && parseFloat(value.weatherElement[1].elementValue.value) >= 0) {
                            north_total = north_total + parseFloat(value.weatherElement[1].elementValue.value);
                            north_length++;
                        }
                        if (mid.indexOf(value.parameter[0].parameterValue) >= 0 && parseFloat(value.weatherElement[1].elementValue.value) >= 0) {
                            mid_total = mid_total + parseFloat(value.weatherElement[1].elementValue.value);
                            mid_length++;
                        }
                        if (south.indexOf(value.parameter[0].parameterValue) >= 0 && parseFloat(value.weatherElement[1].elementValue.value) >= 0) {
                            south_total = south_total + parseFloat(value.weatherElement[1].elementValue.value);
                            south_length++;
                        }
                        if (east.indexOf(value.parameter[0].parameterValue) >= 0 && parseFloat(value.weatherElement[1].elementValue.value) >= 0) {
                            east_total = east_total + parseFloat(value.weatherElement[1].elementValue.value);
                            east_length++;
                        }
                    })
                    console.log("北部60分鐘總雨量", north_total, "資料筆數:", north_length);
                    console.log("中部60分鐘總雨量", mid_total, "資料筆數:", mid_length);
                    console.log("南部60分鐘總雨量", south_total, "資料筆數:", south_length);
                    console.log("東部60分鐘總雨量", east_total, "資料筆數:", east_length);

                    // 撈出各地區24小時總雨量
                    north_total24 = 0;
                    mid_total24 = 0;
                    south_total24 = 0;
                    east_total24 = 0;
                    north_length24 = 0;
                    mid_length24 = 0;
                    south_length24 = 0;
                    east_length24 = 0;
                    data.forEach((value, key) => {
                        if (north.indexOf(value.parameter[0].parameterValue) >= 0 && parseFloat(value.weatherElement[6].elementValue.value) >= 0) {
                            north_total24 = north_total24 + parseFloat(value.weatherElement[6].elementValue.value);
                            north_length24++;
                        }
                        if (mid.indexOf(value.parameter[0].parameterValue) >= 0 && parseFloat(value.weatherElement[6].elementValue.value) >= 0) {
                            mid_total24 = mid_total24 + parseFloat(value.weatherElement[6].elementValue.value);
                            mid_length24++;
                        }
                        if (south.indexOf(value.parameter[0].parameterValue) >= 0 && parseFloat(value.weatherElement[6].elementValue.value) >= 0) {
                            south_total24 = south_total24 + parseFloat(value.weatherElement[6].elementValue.value);
                            south_length24++;
                        }
                        if (east.indexOf(value.parameter[0].parameterValue) >= 0 && parseFloat(value.weatherElement[6].elementValue.value) >= 0) {
                            east_total24 = east_total24 + parseFloat(value.weatherElement[6].elementValue.value);
                            east_length24++;
                        }
                    })
                    console.log("北部24小時總雨量", north_total24, "資料筆數:", north_length24);
                    console.log("中部24小時總雨量", mid_total24, "資料筆數:", mid_length24);
                    console.log("南部24小時總雨量", south_total24, "資料筆數:", south_length24);
                    console.log("東部24小時總雨量", east_total24, "資料筆數:", east_length24);

                    // 各地區60分鐘總降雨量
                    $("#60min_total").on("click", function () {
                        $("#myChart2").hide();
                        $("#myChart").show();
                        
                    });
                    $("#24hr_total").on("click", function () {
                        $("#myChart2").show();
                        $("#myChart").hide();
                        
                    });
                    const ctx = document.getElementById('myChart');
                        const myChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['北部', '中部', '南部', '東部'],
                                datasets: [{
                                    label: '60分鐘總雨量(mm)',
                                    data: [north_total, mid_total, south_total, east_total],
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.2)',
                                        'rgba(54, 162, 235, 0.2)',
                                        'rgba(255, 206, 86, 0.2)',
                                        'rgba(75, 192, 192, 0.2)',
                                        'rgba(153, 102, 255, 0.2)',
                                        'rgba(255, 159, 64, 0.2)'
                                    ],
                                    borderColor: [
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(153, 102, 255, 1)',
                                        'rgba(255, 159, 64, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });

                        const ctx2 = document.getElementById('myChart2');
                        const myChart2 = new Chart(ctx2, {
                            type: 'bar',
                            data: {
                                labels: ['北部', '中部', '南部', '東部'],
                                datasets: [{
                                    label: '24小時總雨量(mm)',
                                    data: [north_total24, mid_total24, south_total24, east_total24],
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.2)',
                                        'rgba(54, 162, 235, 0.2)',
                                        'rgba(255, 206, 86, 0.2)',
                                        'rgba(75, 192, 192, 0.2)',
                                        'rgba(153, 102, 255, 0.2)',
                                        'rgba(255, 159, 64, 0.2)'
                                    ],
                                    borderColor: [
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(153, 102, 255, 1)',
                                        'rgba(255, 159, 64, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });








                }


            });


        });





    </script>


</body>

</html>